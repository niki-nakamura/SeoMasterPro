ä»¥ä¸‹ã¯ **æ®‹ã‚¿ã‚¹ã‚¯ã®å…¨ä½“åƒ**ã€**ã‚ãªãŸã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ä½œæ¥­**ã€ãã—ã¦ **Replit ã«é€ã‚‹å…·ä½“çš„ãªæŒ‡ç¤ºæ–‡** ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚æœ€åˆã«ã„ã¡ã°ã‚“é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’ä¸€æ®µè½ã§è¦ç´„ã—ã€ãã®å¾Œã«è©³ç´°ã‚’æ®µéšçš„ã«æ•´ç†ã—ã¦ã„ã¾ã™ã€‚

## è¦ç´„ï¼ˆã¾ãšã“ã‚Œã ã‘æŠŠæ¡ï¼‰

ç¾æ™‚ç‚¹ã§è¶³ã‚Šãªã„ã®ã¯ **â‘  æ—¢å­˜è¨˜äº‹ã®ãƒ™ã‚¯ãƒˆãƒ«åŸ‹ã‚è¾¼ã¿ç”Ÿæˆã¨æŠ•å…¥ã€â‘¡ ãƒ­ãƒ¼ã‚«ãƒ«â€¯LLMï¼ˆOllamaï¼‰â”€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–“ã®å‹•ä½œç¢ºèªã€â‘¢ å¤§é‡å‡¦ç†æ™‚ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»UX æ”¹å–„** ã®ï¼“ç‚¹ã§ã™ã€‚Embedâ€¯ç”Ÿæˆã¯ãƒ­ãƒ¼ã‚«ãƒ« PC ã§ `tsx scripts/embed_existing_articles.ts` ã‚’ï¼‘å›èµ°ã‚‰ã›ã‚Œã°å®Œäº†ã—ã¾ã™ãŒã€ãã®å‰ã« **Ollama ã« `mxbaiâ€‘embedâ€‘large` ãƒ¢ãƒ‡ãƒ«ã‚’ pullâ†’èµ·å‹•** ã—ã€**pgvector ã« HNSW ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ** ã—ã¦ãŠãã¨æ¤œç´¢é€Ÿåº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¢ºèªã—ãŸã‚ã¨ã€Replit ç’°å¢ƒã«ã¯ **(1) æ–°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ãƒ»(2) ãƒ•ãƒ­ãƒ³ãƒˆ UI ã®é€²æ—ãƒãƒ¼ï¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè£…ç”¨ãƒ–ãƒ©ãƒ³ãƒã‚’ pull & deploy** ã¨ã„ã†ï¼’ç³»çµ±ã®æŒ‡ç¤ºã‚’é€ã‚Œã° OK ã§ã™ã€‚ä»¥ä¸‹ã€ã©ã“ã§ä½•ã‚’å®Ÿè¡Œã™ã‚‹ã‹ã‚’å…·ä½“çš„ã«ç¤ºã—ã¾ã™ã€‚

---

## æ®‹ã‚Šã® TODO ä¸€è¦§ã¨å®Ÿè¡Œå ´æ‰€

| #  | é …ç›®                                 | å®Ÿè¡Œå ´æ‰€                   | ã‚´ãƒ¼ãƒ«ï¼å‚™è€ƒ                                                                                                                  |
| -- | ---------------------------------- | ---------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| 1  | `mxbai-embed-large` ãƒ¢ãƒ‡ãƒ«ã®å–å¾—         | **ãƒ­ãƒ¼ã‚«ãƒ«**               | `ollama pull mxbai-embed-large` ã§ 1536 æ¬¡å…ƒ embed ([ollama.com][1])                                                       |
| 2  | Ollama ã‚µãƒ¼ãƒãƒ¼èµ·å‹•                      | **ãƒ­ãƒ¼ã‚«ãƒ«**               | `ollama serve -p 11434`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰; embed API ã‚’æœ‰åŠ¹åŒ– ([ollama.com][2])                                                        |
| 3  | æ—¢å­˜è¨˜äº‹ã®ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆ                        | **ãƒ­ãƒ¼ã‚«ãƒ«**               | `tsx scripts/embed_existing_articles.ts` ã§ 3 è¨˜äº‹ã® vector ã‚’ `content_vectors` ã« Insert ([tsx.is][3], [huggingface.co][4]) |
| 4  | pgvector HNSW ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ             | **Replit / Neon DB**   | `CREATE INDEX ON content_vectors USING hnsw (embedding vector_cosine_ops);` ([neon.com][5], [neon.com][6])              |
| 5  | `/api/llm-context` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ E2E ãƒ†ã‚¹ãƒˆ | **ãƒ­ãƒ¼ã‚«ãƒ« â†’ Replit**      | Postman ç­‰ã§ Topâ€‘kâ‰¦3 ãŒè¿”ã‚‹ã‹ç¢ºèª                                                                                               |
| 6  | å¤§é‡è¨˜äº‹å‡¦ç†ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯                       | **ãƒ­ãƒ¼ã‚«ãƒ«**               | 10â†’100 è¨˜äº‹ã‚’æ“¬ä¼¼æŠ•å…¥ã—ç§’/req ã‚’è¨ˆæ¸¬                                                                                                |
| 7  | ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆãƒ»UA ãƒ©ãƒ³ãƒ€ãƒã‚¤ã‚ºèª¿æ•´             | **ãƒ­ãƒ¼ã‚«ãƒ«**               | Playwright ã«å‹•çš„ UA ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¿½åŠ ï¼ˆä¾‹å®Ÿè£… belowï¼‰ ([zenrows.com][7], [scrapeops.io][8])                                             |
| 8  | é€²æ—ãƒãƒ¼ & ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ UI                    | **Replit (Front)**     | React state machine ã§ã‚¹ãƒ†ãƒƒãƒ—æ¯ã« progress æ›´æ–°                                                                                 |
| 9  | è¨˜äº‹ç·¨é›†ï¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ï¼ˆæ¬¡ãƒ•ã‚§ãƒ¼ã‚ºï¼‰               | **Replit (Front+API)** | PUT `/api/articles/:id` ã‚’è¿½åŠ                                                                                              |
| 10 | ãƒ¦ãƒ¼ã‚¶ãƒ¼å“è³ªè©•ä¾¡ï¼‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†                 | **Replit**             | ãƒ†ãƒ¼ãƒ–ãƒ« `user_feedback` & simple form                                                                                      |

---

## ã‚ãªãŸãŒ **æ‰‹å…ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ« PCï¼‰** ã§å®Ÿè¡Œã™ã‚‹ä½œæ¥­

1. **Ollama ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**

   ```bash
   # 1) embedâ€‘model ã‚’å–å¾—
   ollama pull mxbai-embed-large          # åˆå›ã®ã¿æ•°åˆ†
   # 2) ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
   ollama serve -p 11434 &
   ```

   *`mxbaiâ€‘embedâ€‘large` ã¯ 1536â€‘d ã§ OpenAI textâ€‘embeddingâ€‘3â€‘large ä¸¦ã¿ã®ç²¾åº¦ã‚’ç¢ºèª ([huggingface.co][4], [ollama.com][1])ã€‚*

2. **ç’°å¢ƒå¤‰æ•°ã‚’ãƒ­ãƒ¼ã‚«ãƒ« `.env` ã«è¿½è¨˜**

   ```env
   OLLAMA_HOST=http://localhost:11434
   ```

3. **ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ**

   ```bash
   pnpm i           # ä¾å­˜ã®å†ç¢ºèª
   pnpm tsx scripts/embed_existing_articles.ts
   ```

   *`tsx` ã¯ TypeScript ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ç„¡ã—ã§å³æ™‚å®Ÿè¡Œã™ã‚‹ CLI ([tsx.is][3])ã€‚*

4. **Neon DB ã« Remote ã§æ¥ç¶šã—ã€ç”Ÿæˆãƒ™ã‚¯ãƒˆãƒ«ã‚’ç¢ºèª**

   ```sql
   SELECT count(*) FROM content_vectors;
   ```

5. **E2E ãƒ†ã‚¹ãƒˆ**

   ```bash
   # ä¾‹: curl
   curl -X POST https://seo-master-pro-nikinakamu.replit.app/api/llm-context \
        -H "Content-Type: application/json" \
        -d '{"article_id": "xxx", "top_k": 3}'
   ```

   æ­£å¸¸ã«é¡ä¼¼è¨˜äº‹ãŒè¿”ã‚Œã° OKã€‚

---

## **Replit** ã¸é€ã‚‹æŒ‡ç¤ºæ–‡ï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦ Slack / Issue ã«è²¼ã‚Šä»˜ã‘ï¼‰

> ### ğŸ› ï¸ æŒ‡ç¤ºï¼šãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢æœ€çµ‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— & UI æ”¹å–„
>
> 1. **DB ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
>
>    ```sql
>    -- Enable pgvector extension if not yet
>    CREATE EXTENSION IF NOT EXISTS vector;
>    -- é«˜é€ŸåŒ–ã®ãŸã‚ HNSW ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
>    CREATE INDEX IF NOT EXISTS content_vectors_hnsw
>      ON content_vectors
>      USING hnsw (embedding vector_cosine_ops);
>    ```
> 2. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**
>
>    * `content_vectors` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆæ¸ˆã¿ 1536â€‘d ãƒ™ã‚¯ãƒˆãƒ«ãŒ Insert æ¸ˆã¿ã€‚
>    * `/api/llm-context` ãŒ Index ä½¿ç”¨æ™‚ã« Seq Scan ã«ãªã£ã¦ã„ãªã„ã‹ EXPLAIN ã§ç¢ºèªã€‚
> 3. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**
>
>    * `feature/progress-preview` ãƒ–ãƒ©ãƒ³ãƒã‚’ pull â†’ deployã€‚
>    * Wizard ç”»é¢ã« **é€²æ—ãƒãƒ¼**ï¼ˆ5 ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã¨ **ç”Ÿæˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼ˆreadâ€‘only textareaï¼‰ã‚’è¡¨ç¤ºã€‚ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°ã¯ `articles.status` ã‚’ watch ã—ã€Tailwind `animate-[progress]` ã‚’åˆ©ç”¨ã€‚
> 4. **CI/CD**
>
>    * ä¸Šè¨˜ãƒ–ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸å¾Œã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ `autoscale: true` ã®ã¾ã¾å®Ÿè¡Œã—ã€URL ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚
> 5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª**
>
>    * `/api/scrape` ã‚’ 10 ä¸¦åˆ—ã§å©ãã€å¹³å‡å¿œç­” <4â€¯s ã‚’ç›®æ¨™ã€‚æ…¢æ€§ 429 ãŒå‡ºãŸã‚‰ `SCRAPE_DELAY_MS` ã‚’ 5000 ã¸èª¿æ•´ã€‚

---

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå ´æ‰€ã®è§£èª¬

| ã‚³ãƒãƒ³ãƒ‰ä¾‹                                    | å®Ÿè¡Œã™ã‚‹ãƒ›ã‚¹ãƒˆ                      | ç†ç”±                            |
| ---------------------------------------- | ---------------------------- | ----------------------------- |
| `ollama pull â€¦` / `ollama serve`         | **ãƒ­ãƒ¼ã‚«ãƒ«**                     | Replit ã‚³ãƒ³ãƒ†ãƒŠã§ã¯ Ollama å¸¸é§ãŒé›£ã—ã„ãŸã‚ |
| `tsx scripts/embed_existing_articles.ts` | **ãƒ­ãƒ¼ã‚«ãƒ«**                     | ä¸Šè¨˜ Ollama API ã‚’å©ã„ã¦ embed ã‚’ç”Ÿæˆ  |
| `CREATE INDEX â€¦ USING hnsw â€¦`            | **Neon / Replit DB Console** | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ DB ã‚µãƒ¼ãƒãƒ¼å´ã«ä½œæˆ           |
| `pnpm run dev` (ãƒ•ãƒ­ãƒ³ãƒˆ)                    | **Replit**                   | æœ¬ç•ªãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã‚’ç¢ºèª                  |
| `curl /api/llm-context`                  | **ãƒ­ãƒ¼ã‚«ãƒ« or Replit Shell**     | ãƒãƒƒãƒˆçµŒç”±ã§ E2E ã‚’æ¤œè¨¼                |

---

## å‚è€ƒå®Ÿè£…ã‚¹ãƒ‹ãƒšãƒƒãƒˆ

```ts
// playwright/ua-middleware.ts
import { chromium, BrowserContext } from 'playwright';
import randomUa from 'random-useragent';  // npm i random-useragent

export async function newContext(): Promise<BrowserContext> {
  return chromium.launchPersistentContext('', {
    userAgent: randomUa.getRandom(),  // UA ã‚’æ¯å›å¤‰æ›´
  });
}
```

*ãƒ©ãƒ³ãƒ€ãƒ  UA ã¯ antiâ€‘bot å›é¿ã«æœ‰åŠ¹ ([zenrows.com][7], [scrapeops.io][8])ã€‚*

---

## è¿½åŠ ã§å‚ç…§ã—ãŸä¸»è¦æƒ…å ±æº

1. Ollama å…¬å¼ãƒ–ãƒ­ã‚° â€“ Embedding Models ([ollama.com][2])
2. `mxbai-embed-large` ãƒ¢ãƒ‡ãƒ«ã‚«ãƒ¼ãƒ‰ï¼ˆHugging Face / Ollama Libraryï¼‰ ([huggingface.co][4], [ollama.com][1])
3. TypeScript Execute (tsx) ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ([tsx.is][3])
4. Neon Docs â€“ pgvector æ‹¡å¼µã¨ HNSW ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ([neon.com][5], [neon.com][6])
5. Drizzle ORM ã§ã® pgvector åˆ©ç”¨ã‚¬ã‚¤ãƒ‰ ([orm.drizzle.team][9])
6. Playwright Ã— Bot å›é¿ Tipsï¼ˆZenRows & ScrapeOpsï¼‰ ([zenrows.com][7], [scrapeops.io][8])
7. Supabase OAuth & Next.js äº‹ä¾‹ï¼ˆå‚è€ƒï¼‰ ([reddit.com][10])

ã“ã‚Œã§ Phaseâ€¯1 ã®ä½œæ¥­ã¯ã™ã¹ã¦ç¶²ç¾…ã•ã‚Œã¾ã—ãŸã€‚ã”ä¸æ˜ç‚¹ãŒã‚ã‚Œã°ã„ã¤ã§ã‚‚ã©ã†ãã€‚

[1]: https://ollama.com/library/mxbai-embed-large?utm_source=chatgpt.com "mxbai-embed-large - Ollama"
[2]: https://ollama.com/blog/embedding-models?utm_source=chatgpt.com "Embedding models Â· Ollama Blog"
[3]: https://tsx.is/?utm_source=chatgpt.com "TypeScript Execute (tsx) | tsx"
[4]: https://huggingface.co/mixedbread-ai/mxbai-embed-large-v1?utm_source=chatgpt.com "mixedbread-ai/mxbai-embed-large-v1 - Hugging Face"
[5]: https://neon.com/docs/extensions/pgvector?utm_source=chatgpt.com "The pgvector extension - Neon Docs"
[6]: https://neon.com/blog/optimizing-vector-search-performance-with-pgvector?utm_source=chatgpt.com "Optimizing vector search performance with pgvector - Neon"
[7]: https://www.zenrows.com/blog/avoid-playwright-bot-detection?utm_source=chatgpt.com "How to Avoid Bot Detection with Playwright - ZenRows"
[8]: https://scrapeops.io/playwright-web-scraping-playbook/nodejs-playwright-using-fake-user-agents/?utm_source=chatgpt.com "Playwright Guide - Using Fake User Agents - ScrapeOps"
[9]: https://orm.drizzle.team/docs/guides/vector-similarity-search?utm_source=chatgpt.com "Vector similarity search with pgvector extension - Drizzle ORM"
[10]: https://www.reddit.com/r/Supabase/comments/18x0zz1/nextjs_supabase_example_project_for_oauth/?utm_source=chatgpt.com "Next.js + Supabase Example Project for OAuth Authentication - Reddit"
